# 电控第三次作业



## 填入姓名：

- 曾蕊



## ＧＩＴ使用

### Git 工作流程

![img](https://www.runoob.com/wp-content/uploads/2015/02/git-process.png)

- 先fork目标工程目录到自己分支

  ![zr](E:\2023rm\xxbj\3\0.png)

- 克隆 Git 资源作为工作目录

  ![ｚｒ](E:\2023rm\xxbj\3\1.png)

- 在克隆的资源上添加或修改文件

  ![zr](E:\2023rm\xxbj\3\2.png)

- 若其他人对源工程进行了修改，可以更新资源

- 怎么更换git远程仓库地址

  方法一：

  直接在当前项目输入一下命令

  ```js
  git remote set-url origin 新的远程仓库地址
  ```

  方法二：

  ```
  git remote origin
  git remote add origin 新的远程仓库地址
  ```

- 添加文件与分支并且push request
  git  clone  拉取目标工程的所有数据，创建一个指向它的 master 分支的指针，并且在本地命名为origin/master。Git生成一个与 origin 的master 分支指向同一个地方的本地 master 分支，并且以此为工作区

```
DELL@DESKTOP-42H1K52 MINGW64 /e/test/51-lcd-mima-duoji (main)
$ git add .  //将该文件夹下的所有文件加入源文件目录下

DELL@DESKTOP-42H1K52 MINGW64 /e/test/51-lcd-mima-duoji (main)
$ git remote -v  //查看仓库
origin  git@github.com:zr31415926/51-lcd-mima-duoji.git (fetch)  //本地仓库
origin  git@github.com:zr31415926/51-lcd-mima-duoji.git (push)
upstream        git@github.com:zr31415926/51-lcd-mima-duoji.git (fetch)  //远程仓库
upstream        git@github.com:zr31415926/51-lcd-mima-duoji.git (push)


DELL@DESKTOP-42H1K52 MINGW64 /e/test/51-lcd-mima-duoji (main)
$ git commit -m "thanks"//修改内容
[main 6ad9754] thanks
 1 file changed, 0 insertions(+), 0 deletions(-)
 create mode 100644 b.txt

DELL@DESKTOP-42H1K52 MINGW64 /e/test/51-lcd-mima-duoji (main)
$ git push -u origin main  //提交到源工程地址
Enumerating objects: 3, done.
Counting objects: 100% (3/3), done.
Delta compression using up to 8 threads
Compressing objects: 100% (2/2), done.
Writing objects: 100% (2/2), 225 bytes | 225.00 KiB/s, done.
Total 2 (delta 1), reused 0 (delta 0), pack-reused 0
remote: Resolving deltas: 100% (1/1), completed with 1 local object.
To github.com:zr31415926/51-lcd-mima-duoji.git
   ab5b236..6ad9754  main -> main
branch 'main' set up to track 'origin/main'.

DELL@DESKTOP-42H1K52 MINGW64 /e/test/51-lcd-mima-duoji (main)
$ git branch 1  //添加分支

DELL@DESKTOP-42H1K52 MINGW64 /e/test/51-lcd-mima-duoji (main)
$ git branch 2
fatal: a branch named '2' already exists

DELL@DESKTOP-42H1K52 MINGW64 /e/test/51-lcd-mima-duoji (main)
$ git branch 8_25_1

DELL@DESKTOP-42H1K52 MINGW64 /e/test/51-lcd-mima-duoji (main)
$ git push -u origin 1
Total 0 (delta 0), reused 0 (delta 0), pack-reused 0
remote:
remote: Create a pull request for '1' on GitHub by visiting:
remote:      https://github.com/zr31415926/51-lcd-mima-duoji/pull/new/1
remote:
To github.com:zr31415926/51-lcd-mima-duoji.git

 * [new branch]      1 -> 1
   branch '1' set up to track 'origin/1'.

DELL@DESKTOP-42H1K52 MINGW64 /e/test/51-lcd-mima-duoji (main)
$
```

- ![zr](E:\2023rm\xxbj\3\3.png)


### git 命令

1. **git init**
   初始化一个Git仓库，执行完git init命令后，会生成一个.git目录，该目录包含了资源数据，且只会在仓库的根目录生成（注意打开隐藏文件）

2. **git clone**
   从Git仓库拷贝项目

3. **git config**

   配置信息

4. **git log**

   查看信息

5. **git add** .

   添加所有目标文件到缓存命令

6. **git status**

   查看文件的状态命令

7. **git diff**

   查看更新的详细信息命令

8. **git commit** 

   提交命令

9. **git commit -m**

   "对.txt或.md文件进行修改"

10. **git reset HEAD**

    取消缓存命令

11. **git rm**

    删除命令

12. **git mv**

    移动或重命名命令

13. **git checkout （分支名）**

    切换分支

    

    

## 编码器

### 定时编码器

**编码器**

用于读取电机旋转角度和方向的设备，通过正交编码器可以实现电机速度的反馈。编码器可以使用磁场或光感编码器代替机械开关，提高寿命。使用定时器捕获编码器可以实现测量电机速度，而使用M法测速可以计算电机转动的距离。

**编码器的作用和原理**
编码器用于读取电机的旋转角度和方向
编码器可以通过霍尔元件或光敏开关来测量电机旋转信息
机械式编码器会产生抖动，需要进行去抖处理

**程序捕获编码器**
*法一：*使用上拉电阻模式来捕获编码器信号（编码器公共开关接地）
*法二：*使用状态机形式的程序来捕获编码器信号
*法三：*使用连续读取编码器电平的方式来捕获编码器信号

**编码器捕获功能**
*法一：*通过测量A项和B项的上升沿和下降沿之间的时间差来得到编码器的路程和速度
*法二：*使用ADC端口和外部电路设计来捕获编码器的数值，但需要注意电阻的阻值
*法三：*使用定时器来捕获编码器，STM32单片机带有编码器捕获功能，在void SysTick Handler(void){}函数中引入变量i（i++），当定时器到50ms（任意时间）时，获取此时编码器脉冲数，除以此时的毫秒数即达到此时的电机速度（不完全准确，直接在任意定时器中断里调用__HAL_TIM_IS_TIM_COUNTING_DOWN(&htim3)）

**编码器使用——PWM控制舵机**

*配置CubeMx*

![zr](E:\2023rm\xxbj\3\6.png)

PSC

预分频系数，设置为0时候，默认不分频，如果内部时钟是72Mhz，那么输出的TIM就是72Mhz（103ZET6是72M）。
PSC设置为1时候是2分频，3的时候就是4分频，4的时候......总的来说就是PSC+1倍分频。

ARR

是重装载值，即最大计数值。

即1s内最多计数


CRR

设置占空比，当最大计数值ARR为99，CRR为50时候，占空比为50/(ARR+1)=50/100=1/2


**编码器产生的电信号经过处理后可转换为 PWM 波形**

时钟预分频系数：时钟频率为72MHZ，预分频就是将频率分割，则该时钟频率变成72MHZ/72=1MHZ，但是在设计过程中需要72-1，则一秒钟会数1M次，则1us数一次。

自动重装载值：如果需要定时1ms=1us*1000，预装载数值就是1000-1，在预分频系数确定的情况下，定时的时长就由预装载值确定了。

舵机的频率一般为50MHz，则重载值为10000/50-1=199s



![zr](E:\2023rm\xxbj\3\7.png)

原理：设置pwmVal，加到500再减到0，一直循环，达到呼吸灯的效果

> ​	/**HAL_TIM_Base_Start(&htim1)定时器使能，定期产生中断**/
>
> ​	HAL_TIM_Base_Start(&htim1);
> ​    HAL_TIM_PWM_Start(&htim1, TIM_CHANNEL_1);
> ​    HAL_TIM_PWM_Start(&htim1, TIM_CHANNEL_2);
> ​    HAL_TIM_PWM_Start(&htim1, TIM_CHANNEL_3);
> ​    HAL_TIM_PWM_Start(&htim1, TIM_CHANNEL_1);
> ​    HAL_TIM_Base_Start(&htim8);
> ​    HAL_TIM_PWM_Start(&htim8, TIM_CHANNEL_1);
> ​    HAL_TIM_PWM_Start(&htim8, TIM_CHANNEL_2);
> ​    HAL_TIM_PWM_Start(&htim8, TIM_CHANNEL_3);